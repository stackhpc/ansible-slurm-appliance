# default proxy address to hostname of first squid host, port 3128
# if squid group non-empty, else else empty string to avoid breaking hostvars

# override these to provide basic_auth:
proxy_basic_user: ''
proxy_basic_password: ''

# some indirection to make this logic easier:
proxy_http_address: "{{ hostvars[groups['squid'].0].api_address }}"
proxy_http_port: "{{ squid_http_port }}"
proxy_basic_auth: "{{ proxy_basic_user }}:{{ proxy_basic_password }}@"
proxy_http_proxy_default: >-
  {{ 'http://' +
     (proxy_basic_auth if proxy_basic_password != '' else '') +
     proxy_http_address + ':' + (proxy_http_port | string)
  }}
proxy_http_proxy: "{{ proxy_http_proxy_default if groups['squid'] else '' }}"
