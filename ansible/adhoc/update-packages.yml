---
- hosts: update
  become: true
  gather_facts: false
  tasks:
    - name: Update selected packages
      ansible.builtin.dnf:
        name: "{{ update_name }}"
        state: "{{ update_state }}"
        exclude: "{{ update_exclude }}"
        disablerepo: "{{ update_disablerepo }}"
      register: updates
    - name: Log updated packages
      ansible.builtin.copy:
        content: "{{ updates.results | join('\n') }}"
        dest: "{{ update_log_path }}"
        mode: "0644"
      delegate_to: localhost
    - ansible.builtin.debug:
        msg: "{{ updates.results | length }} changes to packages - see {{ update_log_path }} for details"
