---

- name: Setup block devices
  hosts: block_devices
  become: yes
  tags: block_devices
  tasks:
    - include_role:
        name: block_devices

- name: Setup NFS
  hosts: nfs
  become: true
  tags:
    - nfs
  tasks:
    - include_role:
        name: stackhpc.nfs

- name: Setup SpectrumScale
  hosts: spectrum_scale
  become: yes
  gather_facts: yes
  tags:
    - spectrum_scale
  collections:
    - ibm.spectrum_scale
  vars:
    ansible_distribution: RedHat # Rocky not officially supported
  tasks:
    - include_role:
        name: ibm.spectrum_scale.core_prepare
    - include_role:
        name: ibm.spectrum_scale.core_install
    - include_role:
        name: ibm.spectrum_scale.core_configure
      when: "'builder' not in group_names"
    - include_role:
        name: ibm.spectrum_scale.remotemount_configure
      when:
        - "'builder' not in group_names"
        - "scale_remotemount_filesystem_name | length > 0"
    - include_role:
        name: ibm.spectrum_scale.core_verify
      when: "'builder' not in group_names"
