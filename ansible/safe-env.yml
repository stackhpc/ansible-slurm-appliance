---
- hosts: localhost
  gather_facts: no
  become: no
  vars:
    protected_environments:
      - prd
  tasks:
    - name: Confirm continuing if using production environment
      ansible.builtin.pause:
        prompt: |
          *************************************
          *  WARNING: PROTECTED ENVIRONMENT!  *
          *************************************

          Current environment: {{ appliances_environment_name }}
          Do you really want to continue (yes/no)?
      register: env_confirm_safe
      when:
        - appliances_environment_name in protected_environments
        - not (prd_continue | default(false) | bool)
      failed_when: not (env_confirm_safe.user_input | bool)