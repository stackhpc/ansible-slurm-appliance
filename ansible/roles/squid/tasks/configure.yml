---
- name: Ensure squid cache directory exists
  ansible.builtin.file:
    path: "{{ squid_cache_dir }}"
    # based on what dnf package creates:
    owner: squid
    group: squid
    mode: u=rwx,g=rw,o=

- name: Template squid configuration
  ansible.builtin.template:
    src: "{{ squid_conf_template }}"
    dest: /etc/squid/squid.conf
    owner: squid
    group: squid
    mode: ug=rwX,go=
  notify: Restart squid

- ansible.builtin.meta: flush_handlers
- name: Ensure squid service state
  ansible.builtin.systemd:
    name: squid
    state: "{{ 'started' if squid_started | bool else 'stopped' }}"
    enabled: "{{ true if squid_enabled else false }}"
