---
- name: Create systemd unit file
  ansible.builtin.template:
    dest: /etc/systemd/system/filebeat.service
    src: filebeat.service.j2
    mode: "0644"
  become: true
  register: _filebeat_unit

- name: Pull container image
  containers.podman.podman_image:
    name: "docker.elastic.co/beats/filebeat-oss"
    tag: "{{ filebeat_version }}"
  # become_user: "{{ filebeat_podman_user }}" # Commenting out as become_user does not imply become: true

- name: Reload filebeat unit file # noqa: no-changed-when
  ansible.builtin.command: systemctl daemon-reload # noqa: command-instead-of-module
  when: _filebeat_unit.changed # noqa: no-handler
  become: true
