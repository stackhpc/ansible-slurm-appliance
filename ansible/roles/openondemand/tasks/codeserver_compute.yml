- name: Download code-server binary
  get_url:
    url: "https://github.com/coder/code-server/releases/download/v4.22.1/code-server-4.22.1-linux-amd64.tar.gz"
    dest: "/tmp/code-server.tar.gz"
    mode: '0644'

- name: Extract code-server binary
  unarchive:
    src: "/tmp/code-server.tar.gz"
    dest: "/opt/"
    remote_src: yes

- name: Symlink code-server to /usr/local/bin
  file:
    src: "/opt/code-server-4.22.1-linux-amd64/bin/code-server"
    dest: "/usr/local/bin/code-server"
    state: link
    force: yes
