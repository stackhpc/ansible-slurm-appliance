---
- name: Setup
  become: true
  become_user: "{{ hpctests_user }}"
  tags: always

  block:
    - ansible.builtin.include_tasks: setup.yml
- name: Pingpong
  become: true
  become_user: "{{ hpctests_user }}"
  tags: pingpong

  block:
    - ansible.builtin.include_tasks: pingpong.yml
      when: hpctests_computes.stdout_lines | length > 1
- name: Pingmatrix
  become: true
  become_user: "{{ hpctests_user }}"
  tags: pingmatrix

  block:
    - ansible.builtin.include_tasks: pingmatrix.yml
      when: hpctests_computes.stdout_lines | length > 1
- name: Build HPL
  become: true
  become_user: "{{ hpctests_user }}"
  tags:
    - hpl-solo

  block:
    - ansible.builtin.include_tasks: build-hpl.yml
- name: Run HPL on individual nodes
  become: true
  become_user: "{{ hpctests_user }}"
  tags:
    - hpl-solo
  block:
    - ansible.builtin.include_tasks: hpl-solo.yml
